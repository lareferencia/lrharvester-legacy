<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:context="http://www.springframework.org/schema/context"
	xmlns:jpa="http://www.springframework.org/schema/data/jpa"
	xmlns:p="http://www.springframework.org/schema/p" xmlns:jdbc="http://www.springframework.org/schema/jdbc"
	xmlns:tx="http://www.springframework.org/schema/tx"
	xmlns:task="http://www.springframework.org/schema/task"
	xsi:schemaLocation="http://www.springframework.org/schema/jdbc http://www.springframework.org/schema/jdbc/spring-jdbc-3.0.xsd
		http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
		http://www.springframework.org/schema/task http://www.springframework.org/schema/task/spring-task-3.0.xsd
		http://www.springframework.org/schema/data/jpa http://www.springframework.org/schema/data/jpa/spring-jpa.xsd
		http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-3.0.xsd
		http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.0.xsd">

	
	<!-- Driver type validator -->
	<bean id="driverTypeRule"
		class="org.lareferencia.backend.validator.ControlledValueContentValidationRule">
		<property name="name" value="type:driver"/>
		<property name="quantifier" value="1..1" />
		<property name="controlledValues">
			<list>
				<value>info:eu-repo/semantics/article</value>
				<value>info:eu-repo/semantics/masterThesis</value>
				<value>info:eu-repo/semantics/doctoralThesis</value>
				<value>info:eu-repo/semantics/report</value>
			</list>
		</property>
	</bean>

	<!-- Status type validator -->	
	<bean id="statusTypeRule"
		class="org.lareferencia.backend.validator.ControlledValueContentValidationRule">
		<property name="name" value="type:status"/>
		<property name="quantifier" value="1..1" />
		<property name="controlledValues">
			<list>
				<value>info:eu-repo/semantics/draft</value>
				<value>info:eu-repo/semantics/acceptedVersion</value>
				<value>info:eu-repo/semantics/submittedVersion</value>
				<value>info:eu-repo/semantics/publishedVersion</value>
				<value>info:eu-repo/semantics/updatedVersion</value>
			</list>
		</property>
	</bean>
	
	<!-- 3 >= Length >= 3 validator -->
	<bean id="langRule"
		class="org.lareferencia.backend.validator.LengthContentValidationRule">
		<property name="name" value="language:lenght:3"/>
		<property name="quantifier" value="1..*" />
		<property name="minLength" value="3"/>
		<property name="maxLength" value="3"/>
	</bean>
	
	<bean id="validator" class="org.lareferencia.backend.validator.ValidatorImpl">
		<property name="fieldValidators">
			<list>

				<!-- Campos obligatorios -->
				<!-- DC:TYPE Validator -->
				<bean class="org.lareferencia.backend.validator.FieldValidator">
					<property name="fieldName" value="dc:type" />
					<property name="mandatory" value="true" />
					<property name="rules">
						<list>
							<ref bean="driverTypeRule" />
							<ref bean="statusTypeRule" />	
						</list>
					</property>
				</bean>
				
				<!-- DC:Identifier Validator -->
				<bean class="org.lareferencia.backend.validator.FieldValidator">
					<property name="fieldName" value="dc:identifier" />
					<property name="mandatory" value="true" />
					<property name="rules">
						<list>
							<!-- Regex valid url validator -->
							<bean
								class="org.lareferencia.backend.validator.RegexContentValidationRule">
								<property name="name" value="identifier:not_empty"/>
								<property name="quantifier" value="1..*" />
								<property name="regexString" value="^(http|https)\://((?!hdl\.handle\.net/123456789$)[a-zA-Z0-9/\-\.\_\?\=&amp;\;\:\@])+"/>
							</bean>
						</list>
					</property>
				</bean>
				
				
				<!-- DC:Title Validator -->
				<bean class="org.lareferencia.backend.validator.FieldValidator">
					<property name="fieldName" value="dc:title" />
					<property name="mandatory" value="true" />
					<property name="rules">
						<list>
							<!-- Length > 1 validator -->
							<bean
								class="org.lareferencia.backend.validator.LengthContentValidationRule">
								<property name="name" value="title:not_empty"/>
								<property name="quantifier" value="1..*" />
								<property name="minLength" value="1"/>
							</bean>
						</list>
					</property>
				</bean>
				
				<!-- DC:Creator Validator -->
				<bean class="org.lareferencia.backend.validator.FieldValidator">
					<property name="fieldName" value="dc:creator" />
					<property name="mandatory" value="true" />
					<property name="rules">
						<list>
							<!-- Length > 1 validator -->
							<bean
								class="org.lareferencia.backend.validator.LengthContentValidationRule">
								<property name="name" value="creator:not_empty"/>
								<property name="quantifier" value="1..*" />
								<property name="minLength" value="1"/>
							</bean>
						</list>
					</property>
				</bean>
				
				<!-- DC:date Validator -->
				<bean class="org.lareferencia.backend.validator.FieldValidator">
					<property name="fieldName" value="dc:date" />
					<property name="mandatory" value="true" />
					<property name="rules">
						<list>
							<!-- Regex date validator -->
							<bean
								class="org.lareferencia.backend.validator.RegexContentValidationRule">
								<property name="name" value="date:regex"/>
								<property name="quantifier" value="1..*" />
								<property name="regexString" value="(^\d{4}$)|(^\d{4}-\d{2}$)|(^\d{4}-\d{2}-\d{2}$)|(^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}([+-]\d{2}:\d{2}|Z)$)"/>
							</bean>
						</list>
					</property>
				</bean>
				
				<!-- Campos NO obligatorios -->
				
				<!-- DC:language Validator -->
				<bean class="org.lareferencia.backend.validator.FieldValidator">
					<property name="fieldName" value="dc:language" />
					<property name="mandatory" value="false" />
					<property name="rules">
						<list>
							<ref bean="langRule"/>
						</list>
					</property>
				</bean>
				
				<!-- DC:rights Validator -->
				<bean class="org.lareferencia.backend.validator.FieldValidator">
					<property name="fieldName" value="dc:rights" />
					<property name="mandatory" value="false" />
					<property name="rules">
						<list>
							<!-- Controlled Values Rights -->
							<bean
								class="org.lareferencia.backend.validator.ControlledValueContentValidationRule">
								<property name="name" value="rights:driver"/>
								<property name="quantifier" value="1..1" />
								<property name="controlledValues">
									<list>
									  <value>info:eu-repo/semantics/openAccess</value>
									  <value>info:eu-repo/semantics/embargoedAccess</value>
									  <value>info:eu-repo/semantics/closedAccess</value>
									  <value>info:eu-repo/semantics/restrictedAccess</value>
									</list>
								</property>
							</bean>
						</list>
					</property>
				</bean>
				
				<!-- DC:subject Validator -->
				<bean class="org.lareferencia.backend.validator.FieldValidator">
					<property name="fieldName" value="dc:subject" />
					<property name="mandatory" value="false" />
					<property name="rules">
						<list>
							<!-- Length > 1 validator -->
							<bean
								class="org.lareferencia.backend.validator.LengthContentValidationRule">
								<property name="name" value="subject:not_empty"/>
								<property name="quantifier" value="1..*" />
								<property name="minLength" value="1"/>
							</bean>
						</list>
					</property>
				</bean>
				
				<!-- DC:description Validator -->
				<bean class="org.lareferencia.backend.validator.FieldValidator">
					<property name="fieldName" value="dc:description" />
					<property name="mandatory" value="false" />
					<property name="rules">
						<list>
							<!-- Length > 1 validator -->
							<bean
								class="org.lareferencia.backend.validator.LengthContentValidationRule">
								<property name="name" value="description:not_empty"/>
								<property name="quantifier" value="1..*" />
								<property name="minLength" value="1"/>
							</bean>
						</list>
					</property>
				</bean>
				
				<!-- DC:relation Validator -->
				<bean class="org.lareferencia.backend.validator.FieldValidator">
					<property name="fieldName" value="dc:relation" />
					<property name="mandatory" value="false" />
					<property name="rules">
						<list>
							<!-- Length > 1 validator -->
							<bean
								class="org.lareferencia.backend.validator.LengthContentValidationRule">
								<property name="name" value="relation:not_empty"/>
								<property name="quantifier" value="1..*" />
								<property name="minLength" value="1"/>
							</bean>
						</list>
					</property>
				</bean>
				
						
				<!-- DC:format Validator -->
				<bean class="org.lareferencia.backend.validator.FieldValidator">
					<property name="fieldName" value="dc:format" />
					<property name="mandatory" value="false" />
					<property name="rules">
						<list>
							<!-- Length > 1 validator -->
							<bean
								class="org.lareferencia.backend.validator.LengthContentValidationRule">
								<property name="name" value="format:not_empty"/>
								<property name="quantifier" value="1..*" />
								<property name="minLength" value="1"/>
							</bean>
						</list>
					</property>
				</bean>
				
				
			</list>

		</property>
	</bean>
	
	<bean id="transformer" class="org.lareferencia.backend.transformer.TransformerImpl">
	
		<property name="fieldTransformers">
				<list>	
					<!-- DC:TYPE Driver Transformer -->
					<bean class="org.lareferencia.backend.transformer.TranslateContentFieldTransformer">
						<property name="fieldName" value="dc:type" />
						<property name="validationRule" ref="driverTypeRule" />
						<property name="translationMap">
							<map>
					            <entry key="article" value="info:eu-repo/semantics/article"/>
								<entry key="artículo de revista" value="info:eu-repo/semantics/article"/>
								<entry key="Artículo Internacional" value="info:eu-repo/semantics/article"/>
								<entry key="Artículo revisado por pares" value="info:eu-repo/semantics/article"/>
								<entry key="artículo" value="info:eu-repo/semantics/article"/>
								<entry key="articulo" value="info:eu-repo/semantics/article"/>
								<entry key="artigo" value="info:eu-repo/semantics/article"/>
								<entry key="dissertação" value="info:eu-repo/semantics/masterThesis"/>
								<entry key="doctoralThesis" value="info:eu-repo/semantics/doctoralThesis"/>
								<entry key="informe técnico" value="info:eu-repo/semantics/report"/>
								<entry key="journal article" value="info:eu-repo/semantics/article"/>
								<entry key="masterThesis" value="info:eu-repo/semantics/masterThesis"/>
								<entry key="relátorio técnico" value="info:eu-repo/semantics/report"/>
								<entry key="tese" value="info:eu-repo/semantics/doctoralThesis"/>
								<entry key="tesis de doctorado" value="info:eu-repo/semantics/doctoralThesis"/>
								<entry key="tesis de maestría" value="info:eu-repo/semantics/masterThesis"/>
								<entry key="tesis de maestria" value="info:eu-repo/semantics/masterThesis"/>
								<entry key="tesis doctoral" value="info:eu-repo/semantics/doctoralThesis"/>
								<entry key="trabajo de grado" value="info:eu-repo/semantics/masterThesis"/>
					        </map> 
						</property>
					</bean>
					
					<!-- DC:TYPE Status Transformer -->
					<bean class="org.lareferencia.backend.transformer.TranslateContentFieldTransformer">
						<property name="fieldName" value="dc:type" />
						<property name="validationRule" ref="statusTypeRule" />
						<property name="defaultFieldValue" value="info:eu-repo/semantics/publishedVersion"/>
						<property name="translationMap">
							<map>
								<entry key="draft" value="info:eu-repo/semantics/draft"/>
								<entry key="info:eu-repo/semantics/draftVersion" value="info:eu-repo/semantics/draft"/>  
								<entry key="accepted" value="info:eu-repo/semantics/acceptedVersion"/>
								<entry key="info:eu-repo/semantics/accepted" value="info:eu-repo/semantics/acceptedVersion"/>
								<entry key="submitted" value="info:eu-repo/semantics/submittedVersion"/>
								<entry key="info:eu-repo/semantics/submitted" value="info:eu-repo/semantics/submittedVersion"/>
								<entry key="published" value="info:eu-repo/semantics/publishedVersion"/>
								<entry key="info:eu-repo/semantics/published" value="info:eu-repo/semantics/publishedVersion"/>
								<entry key="updated" value="info:eu-repo/semantics/updatedVersion"/>
								<entry key="info:eu-repo/semantics/updated" value="info:eu-repo/semantics/updatedVersion"/>
					        </map> 
						</property>
					</bean>
					
					<!-- DC:LANGUAGE Transformer -->
					<bean class="org.lareferencia.backend.transformer.TranslateContentFieldTransformer">
						<property name="fieldName" value="dc:language" />
						<property name="validationRule" ref="langRule" />
						<property name="defaultFieldValue" value="spa"/>
						<property name="translationMap">
							<map>
								<entry key="de" value="deu"/>
								<entry key="en" value="eng"/>
								<entry key="en_us" value="eng"/>
								<entry key="es" value="spa"/>
								<entry key="esp" value="spa"/>
								<entry key="fr" value="fra"/>
								<entry key="fre" value="fra"/>
								<entry key="it" value="ita"/>
								<entry key="pt" value="por"/>
								<entry key="Spanish" value="spa"/>
					        </map> 
						</property>
					</bean>
				</list>
		</property>
	</bean>
	
    	

</beans>
