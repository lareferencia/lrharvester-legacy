/*!
 * angular-spring-data-rest 0.4.4
 * Copyright 2015 Guy Brand (@guy_labs)
 * https://github.com/guylabs/angular-spring-data-rest
 */
!function(){"use strict";function a(b){return angular.forEach(arguments,function(c){c!==b&&angular.forEach(c,function(c,d){b[d]&&b[d].constructor&&b[d].constructor===Object?a(b[d],c):b[d]=c})}),angular.copy(b)}function b(a,b,c,d){var e=a[b];if(e){var f={};if(f[c]={},d===!0)angular.forEach(Object.keys(e),function(a){f[c][a]=e[a]});else{var g=Object.keys(e)[0];f[c]=e[g]}a=angular.extend(a,f),delete a[b]}return a}function c(a,b){return b&&(a=e(a)),a}function d(a,b,c){if(void 0==a||!a)throw new Error("The provided resource name '"+b+"' has no valid URL in the '"+c+"' property.");return a}function e(a){return a.replace(/{.*}/g,"")}function f(a){var b={},c=/{\?(.*)}/g,d=c.exec(a)[1].split(",");return angular.forEach(d,function(a){b[a]=""}),b}angular.module("spring-data-rest",["ngResource"]),angular.module("spring-data-rest").provider("SpringDataRestAdapter",function(){var e={linksKey:"_links",linksHrefKey:"href",linksSelfLinkName:"self",embeddedKey:"_embedded",embeddedNewKey:"_embeddedItems",embeddedNamedResources:!1,resourcesKey:"_resources",resourcesFunction:void 0,fetchFunction:void 0,fetchAllKey:"_allLinks"};return{config:function(b){if("undefined"!=typeof b){if(!angular.isObject(b))throw new Error("The given configuration '"+b+"' is not an object.");if(void 0!=b.resourcesFunction&&"function"!=typeof b.resourcesFunction)throw new Error("The given resource function '"+b.resourcesFunction+"' is not of type function.");if(void 0!=b.fetchFunction&&"function"!=typeof b.fetchFunction)throw new Error("The given fetch function '"+b.fetchFunction+"' is not of type function.");e=a(e,b)}return e},$get:["$injector",function(a){function g(b,c,d,f){return void 0==e.resourcesFunction?a.get("$resource")(b,c,d,f):e.resourcesFunction(b,c,d,f)}function h(b,c,d,f,g){if(void 0==e.fetchFunction){var h=[];return h.push(a.get("$http").get(b).then(function(a){return g?j(a.data,f,!0).then(function(a){d[c]=a}):j(a.data).then(function(a){d[c]=a})},function(b){return 404!=b.status?a.get("$q").reject(b):void 0})),a.get("$q").all(h)}return e.fetchFunction(b,c,d,f,g)}var i={},j=function k(j,l,m){function n(a,b){var f=d(a[e.linksKey][b][e.linksHrefKey],b,e.linksHrefKey);return c(f,a[e.linksKey][b].templated)}function o(a){return"string"==typeof a&&a.indexOf("/")>0}function p(a){if(o(a)){var b=a.indexOf("/");return[a.substr(0,b),a.substr(b,a.length)]}}return a.get("$q").when(j).then(function(c){var d=function(a,b,d,h){var i=this[e.linksKey],j=b,k="";if(o(a)){var l=p(a);a=l[0],k=l[1]}if(angular.isObject(a)){if(!a.name)throw new Error("The provided resource object must contain a name property.");var m=a.parameters;return b&&angular.isObject(b)?j=m&&angular.isObject(m)?angular.extend(angular.copy(b),angular.copy(m)):angular.copy(b):m&&angular.isObject(m)&&(j=angular.copy(m)),angular.forEach(j,function(a,b){""===a&&delete j[b]}),g(n(c,a.name),j,d,h)}if(a in i)return g(n(c,a)+k,j,d,h);var q=[];return angular.forEach(i,function(a,b){if(a.templated){var c=f(a[e.linksHrefKey]);q.push({name:b,parameters:c})}else q.push({name:b})}),q};if(c&&c.data&&(c=c.data),!angular.isObject(c)||c instanceof Array)return a.get("$q").reject("Given data '"+c+"' is not of type object.");if(l&&!(l instanceof Array||"string"==typeof l))return a.get("$q").reject("Given fetch links '"+l+"' is not of type array or string.");var j=void 0,q=[];if(e.linksKey in c){var r={};if(r[e.resourcesKey]=d,j=angular.extend(angular.copy(c),r),void 0!=l){var s=c[e.linksKey][e.linksSelfLinkName][e.linksHrefKey];i[s]||(i[s]=[]),angular.forEach(c[e.linksKey],function(a,b){b!=e.linksSelfLinkName&&i[s].indexOf(b)<0&&(l==e.fetchAllKey||"string"==typeof l&&b==l||l instanceof Array&&l.indexOf(b)>=0)&&(q.push(h(n(c,b),b,j,l,m)),i[s].push(b))})}}return e.embeddedKey in c&&(j||(j=angular.copy(c)),j=b(j,e.embeddedKey,e.embeddedNewKey,e.embeddedNamedResources),angular.forEach(j[e.embeddedNewKey],function(a,b){if(a instanceof Array&&a.length>0){var c,d=[];angular.forEach(a,function(a,b){angular.isObject(a)?(c=k({data:a},l,m).then(function(a){d[b]=a}),q.push(c)):d[b]=a}),c&&c.then(function(){j[e.embeddedNewKey][b]=d})}else angular.isObject(a)&&q.push(k({data:a},l,m).then(function(a){j[e.embeddedNewKey][b]=a}))})),a.get("$q").all(q).then(function(){return j?j:c})})};return{process:function(a,b,c){return i={},j(a,b,c)}}}]}}),angular.module("spring-data-rest").provider("SpringDataRestInterceptor",["$httpProvider","SpringDataRestAdapterProvider",function(a){return{apply:function(){a.interceptors.push("SpringDataRestInterceptor")},$get:["SpringDataRestAdapter","$q",function(a,b){return{response:function(b){return angular.isObject(b.data)?a.process(b.data).then(function(a){return b.data=a,b}):b}}}]}}])}();